CREATE OR ALTER PROCEDURE BRONZE.LOAD_BRONZE AS
BEGIN

DECLARE  
            @START_TIME DATETIME,
            @END_TIME DATETIME,
            @BATCH_START_TIME DATETIME,
            @BATCH_END_TIME DATETIME
BEGIN 
TRY

    SET @BATCH_START_TIME=GETDATE();

    PRINT'================'
    PRINT'LOADING BRONZE LAYER'
    PRINT'================'

    PRINT '----------------'
    PRINT'LOADING CRM TABLES'
    PRINT '----------------'

    SET @START_TIME=GETDATE();
    PRINT'TRUNCATING TABLE:[bronze].[CRM_CUST_INFO]'
    TRUNCATE TABLE [bronze].[CRM_CUST_INFO];

    PRINT 'INSERTING DATA INTO :[bronze].[CRM_CUST_INFO]'
    BULK INSERT [bronze].[CRM_CUST_INFO]
    FROM 'C:\SQL2025\sql-data-warehouse-project\datasets\source_crm\CUST_INFO.CSV'
    WITH(
    FIRSTROW=2,
    FIELDTERMINATOR =',',
    TABLOCK
    );

    SET @END_TIME=GETDATE();
    PRINT'>>LOAD DURATION:'+cast(datediff(second,@start_time,@end_time)as nvarchar)+'second'
    print'>>>'

    set @START_TIME=GETDATE();
    PRINT'TRUNCATING TABLE:[bronze].[CRM_PROD_INFO]'

    TRUNCATE TABLE [bronze].[CRM_PROD_INFO];
    PRINT 'INSERTING DATA INTO :[bronze].[CRM_PROD_INFO]'

    BULK INSERT  BRONZE.CRM_PROD_INFO
    FROM 'C:\SQL2025\sql-data-warehouse-project\datasets\source_crm\PRD_INFO.CSV'
    WITH (
    FIRSTROW= 2,
    FIELDTERMINATOR=',',
    TABLOCK
    );
    SET @END_TIME=GETDATE();
    PRINT 'LOAD DURATION'+CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME) AS NVARCHAR)+'SECOND';

    SET @START_TIME=GETDATE();

    PRINT'TRUNCATING TABLE:[bronze].[CRM_SALE_DETAILS]'

    TRUNCATE TABLE [bronze].[CRM_SALE_DETAILS];
    PRINT 'INSERTING DATA INTO :[bronze].[CRM_SALE_DETAILS]'

    BULK INSERT [bronze].[CRM_SALE_DETAILS]
    FROM 'C:\SQL2025\sql-data-warehouse-project\datasets\source_crm\sales_details.CSV'
    WITH (
    FIRSTROW=2,
    FIELDTERMINATOR=',',
    TABLOCK
    );
    SET @END_TIME=GETDATE();
    PRINT'LOAD DURATION [CRM_SALE_DETAILS]'+ CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME)AS NVARCHAR)+'SECOND'

    PRINT '----------------';
    PRINT'LOADING ERP TABLES';
    PRINT '----------------';

    SET @START_TIME=GETDATE();
    PRINT'TRUNCATING TABLE:[bronze].[ERP_CUST_AZ12]'

    TRUNCATE TABLE [bronze].[ERP_CUST_AZ12];
    PRINT 'INSERTING DATA INTO [bronze].[ERP_CUST_AZ12]'
    BULK INSERT [bronze].[ERP_CUST_AZ12]
    FROM 'C:\SQL2025\sql-data-warehouse-project\datasets\source_erp\CUST_AZ12.CSV'
    WITH (
    FIRSTROW=2,
    FIELDTERMINATOR=',',
    TABLOCK
    );
    SET @END_TIME= GETDATE();
    PRINT'LOAD DURATION ERP_CUST_AZ12 ; '+ CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME)AS NVARCHAR)+'SECOND'

    PRINT'TRUNCATING TABLE:[bronze].[ERP_CUST_AZ12]'


    TRUNCATE TABLE [bronze].[ERP_LOC_A101]
    PRINT 'INSERTING DATA INTO [bronze].[ERP_CUST_AZ12]'

    BULK INSERT [bronze].[ERP_LOC_A101]
    FROM 'C:\SQL2025\sql-data-warehouse-project\datasets\source_erp\LOC_A101.CSV'
    WITH(
    FIRSTROW=2,
    FIELDTERMINATOR=',',
    TABLOCK
    );

    PRINT'TRUNCATING TABLE:[bronze].[ERP_PX_CAT_G1V2]'
    SET @END_TIME=GETDATE();
    PRINT'>>LOAD DURATION ERP_PX_CAT_G1V2;'+CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME)AS NVARCHAR)+'SECOND'

    SET @START_TIME=GETDATE();
    TRUNCATE TABLE [bronze].[ERP_PX_CAT_G1V2];
    PRINT 'INSERTING DATA INTO [bronze].[ERP_PX_CAT_G1V2]'

    BULK INSERT [bronze].[ERP_PX_CAT_G1V2]
    FROM 'C:\SQL2025\sql-data-warehouse-project\datasets\source_erp\PX_CAT_G1V2.CSV'
    WITH (
    FIRSTROW=2,
    FIELDTERMINATOR=',',
    TABLOCK
    );

    SET @END_TIME=GETDATE();
    PRINT'>>LOAD DURATION ERP_PX_CAT_G1V2;'+CAST(DATEDIFF(SECOND,@START_TIME,@END_TIME)AS NVARCHAR)+'SECOND'

    SET @BATCH_END_TIME=GETDATE();
    PRINT'===================================================';
    PRINT'BATCH LOAD TIME '+ CAST(DATEDIFF(SECOND,@BATCH_START_TIME,@BATCH_END_TIME)AS NVARCHAR)+'SECOND'
    PRINT '===================================================';
END TRY

BEGIN CATCH
    PRINT'=========================================='
    PRINT 'ERROR OCCURED DURING LOADING BRONZE LAYER'
    PRINT 'ERROR MESSAGE'+ ERROR_MESSAGE();
    PRINT 'ERROR MESSAGE'+ CAST (ERROR_NUMBER()AS NVARCHAR(50));
    PRINT 'ERROR MESSAGE'+ CAST (ERROR_STATE()AS NVARCHAR(50));
    PRINT'=========================================='
END CATCH
END;

 EXEC   BRONZE.LOAD_BRONZE
